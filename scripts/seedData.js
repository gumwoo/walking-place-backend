const { Breed, Term } = require('../src/models');
const logger = require('../src/config/logger');
const fs = require('fs');
const path = require('path');

/**
 * í•„ìˆ˜ ë°ì´í„° ìƒì„± (ê²¬ì¢… + ì•½ê´€)
 */
async function seedData() {
  try {
    logger.info('í•„ìˆ˜ ë°ì´í„° ìƒì„± ì‹œìž‘');

    // 1. ì‹¤ì œ í¬ë¡¤ë§ëœ ê²¬ì¢… ë°ì´í„° ì‚¬ìš©
    console.log('ðŸ“– í¬ë¡¤ë§ëœ ê²¬ì¢… ë°ì´í„° ë¡œë”© ì¤‘...');
    
    const breedJsonPath = path.join(__dirname, '../src/dog-breed-crawler/korean_dog_breeds.json');
    
    if (!fs.existsSync(breedJsonPath)) {
      console.error('âŒ ê²¬ì¢… ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', breedJsonPath);
      console.log('ðŸ’¡ ë¨¼ì € ê²¬ì¢… í¬ë¡¤ë§ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”: node src/dog-breed-crawler/crawler_korean.js');
      return;
    }

    const breedData = JSON.parse(fs.readFileSync(breedJsonPath, 'utf8'));
    console.log(`âœ… ì´ ${breedData.total_breeds}ê°œì˜ ê²¬ì¢… ë°ì´í„° ë¡œë”© ì™„ë£Œ`);

    // ê²¬ì¢… ë°ì´í„° ì‚½ìž…
    let insertedCount = 0;
    let skippedCount = 0;

    for (const breedName of breedData.all_breeds) {
      try {
        const [breed, created] = await Breed.findOrCreate({
          where: { name: breedName },
          defaults: {
            name: breedName,
            icon_url: `https://example.com/breeds/${encodeURIComponent(breedName.toLowerCase())}.png`
          }
        });

        if (created) {
          insertedCount++;
          console.log(`  âœ“ ${breedName}`);
        } else {
          skippedCount++;
        }
      } catch (error) {
        console.error(`  âŒ ${breedName} ì‚½ìž… ì‹¤íŒ¨:`, error.message);
      }
    }

    console.log(`\nðŸ“Š ê²¬ì¢… ë°ì´í„° ì²˜ë¦¬ ê²°ê³¼:`);
    console.log(`  - ìƒˆë¡œ ì¶”ê°€: ${insertedCount}ê°œ`);
    console.log(`  - ì´ë¯¸ ì¡´ìž¬: ${skippedCount}ê°œ`);

    // 2. í•„ìˆ˜ ì•½ê´€ ë°ì´í„° (ë²•ì ìœ¼ë¡œ í•„ìš”)
    console.log('\nðŸ“‹ ì•½ê´€ ë°ì´í„° ìƒì„± ì¤‘...');
    
    const terms = [
      {
        title: 'ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€',
        content: `ì œ1ì¡° (ëª©ì )
ë³¸ ì•½ê´€ì€ ì‚°ì±…ëª…ì†Œ ì•±(ì´í•˜ "ì„œë¹„ìŠ¤")ì˜ ì´ìš©ì¡°ê±´ ë° ì ˆì°¨, íšŒì‚¬ì™€ ì´ìš©ìžì˜ ê¶Œë¦¬, ì˜ë¬´, ì±…ìž„ì‚¬í•­ê³¼ ê¸°íƒ€ í•„ìš”í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ì œ2ì¡° (ì •ì˜)
1. "ì„œë¹„ìŠ¤"ëž€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ë°˜ë ¤ë™ë¬¼ ì‚°ì±… ê´€ë ¨ ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ê´€ë ¨ ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
2. "ì´ìš©ìž"ëž€ ë³¸ ì•½ê´€ì— ë”°ë¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íšŒì›ì„ ë§í•©ë‹ˆë‹¤.

ì œ3ì¡° (ì„œë¹„ìŠ¤ì˜ ì œê³µ)
íšŒì‚¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
- ë°˜ë ¤ë™ë¬¼ ì‚°ì±…ë¡œ ì¶”ì²œ ì„œë¹„ìŠ¤
- ì‚°ì±… ê¸°ë¡ ê´€ë¦¬ ì„œë¹„ìŠ¤
- ë§ˆí‚¹ í¬í† ì¡´ ì„œë¹„ìŠ¤`,
        is_required: true,
        version: '1.0'
      },
      {
        title: 'ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨',
        content: `ê°œì¸ì •ë³´ë³´í˜¸ë²• ì œ30ì¡°ì— ë”°ë¼ ì •ë³´ì£¼ì²´ì˜ ê°œì¸ì •ë³´ë¥¼ ë³´í˜¸í•˜ê³  ì´ì™€ ê´€ë ¨í•œ ê³ ì¶©ì„ ì‹ ì†í•˜ê³  ì›í™œí•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìžˆë„ë¡ í•˜ê¸° ìœ„í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì„ ìˆ˜ë¦½Â·ê³µê°œí•©ë‹ˆë‹¤.

ì œ1ì¡° (ê°œì¸ì •ë³´ì˜ ì²˜ë¦¬ëª©ì )
íšŒì‚¬ëŠ” ë‹¤ìŒì˜ ëª©ì ì„ ìœ„í•˜ì—¬ ê°œì¸ì •ë³´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤:
- íšŒì› ê°€ìž… ë° ê´€ë¦¬
- ì„œë¹„ìŠ¤ ì œê³µì— ê´€í•œ ê³„ì•½ ì´í–‰
- ë§ˆì¼€íŒ… ë° ê´‘ê³ ì—ì˜ í™œìš©

ì œ2ì¡° (ê°œì¸ì •ë³´ì˜ ì²˜ë¦¬ ë° ë³´ìœ ê¸°ê°„)
íšŒì‚¬ëŠ” ë²•ë ¹ì— ë”°ë¥¸ ê°œì¸ì •ë³´ ë³´ìœ Â·ì´ìš©ê¸°ê°„ ë˜ëŠ” ì •ë³´ì£¼ì²´ë¡œë¶€í„° ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘ ì‹œì— ë™ì˜ë°›ì€ ê°œì¸ì •ë³´ ë³´ìœ Â·ì´ìš©ê¸°ê°„ ë‚´ì—ì„œ ê°œì¸ì •ë³´ë¥¼ ì²˜ë¦¬Â·ë³´ìœ í•©ë‹ˆë‹¤.`,
        is_required: true,
        version: '1.0'
      },
      {
        title: 'ìœ„ì¹˜ì •ë³´ ì´ìš©ì•½ê´€',
        content: `ìœ„ì¹˜ì •ë³´ì˜ ë³´í˜¸ ë° ì´ìš© ë“±ì— ê´€í•œ ë²•ë¥  ì œ16ì¡°ì— ë”°ë¼ ìœ„ì¹˜ì •ë³´ ì´ìš©ì— ê´€í•œ ì‚¬í•­ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •í•©ë‹ˆë‹¤.

ì œ1ì¡° (ìœ„ì¹˜ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì )
íšŒì‚¬ëŠ” ë‹¤ìŒì˜ ëª©ì ìœ¼ë¡œ ê°œì¸ìœ„ì¹˜ì •ë³´ë¥¼ ìˆ˜ì§‘ ë° ì´ìš©í•©ë‹ˆë‹¤:
- ì£¼ë³€ ì‚°ì±…ë¡œ ë° ë°˜ë ¤ë™ë¬¼ ê´€ë ¨ ì‹œì„¤ ì •ë³´ ì œê³µ
- ì‚°ì±… ê²½ë¡œ ê¸°ë¡ ë° ë¶„ì„
- ìœ„ì¹˜ ê¸°ë°˜ ë§žì¶¤í˜• ì„œë¹„ìŠ¤ ì œê³µ

ì œ2ì¡° (ê°œì¸ìœ„ì¹˜ì •ë³´ì˜ ìˆ˜ì§‘ë°©ë²•)
íšŒì‚¬ëŠ” ì´ìš©ìžì˜ ë™ì˜ë¥¼ ë°›ì•„ GPSì¹© ë“±ì˜ ìœ„ì¹˜ì¸¡ì •ê¸°ìˆ ì´ íƒ‘ìž¬ëœ ì´ìš©ìžì˜ íœ´ëŒ€í°ì„ í†µí•´ ê°œì¸ìœ„ì¹˜ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

ì œ3ì¡° (ê°œì¸ìœ„ì¹˜ì •ë³´ì˜ ë³´ìœ ê¸°ê°„)
ê°œì¸ìœ„ì¹˜ì •ë³´ëŠ” ìˆ˜ì§‘ ëª©ì  ë‹¬ì„± í›„ ì¦‰ì‹œ íŒŒê¸°í•©ë‹ˆë‹¤. ë‹¨, ì‚°ì±… ê¸°ë¡ì€ ì´ìš©ìžê°€ ì‚­ì œ ìš”ì²­í•˜ê¸° ì „ê¹Œì§€ ë³´ê´€ë©ë‹ˆë‹¤.`,
        is_required: true,
        version: '1.0'
      },
      {
        title: 'ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜',
        content: `ì„œë¹„ìŠ¤ ê´€ë ¨ í˜œíƒ ë° ì´ë²¤íŠ¸ ì •ë³´, ì‹ ê·œ ì„œë¹„ìŠ¤ ì•ˆë‚´ ë“±ì„ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ìˆ˜ì‹  ë°©ë²•:
- ì•± í‘¸ì‹œ ì•Œë¦¼
- ì´ë©”ì¼
- SMS

ìˆ˜ì‹ ê±°ë¶€:
ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹ ì„ ì›í•˜ì§€ ì•Šìœ¼ì‹¤ ê²½ìš° ì–¸ì œë“ ì§€ ì•± ì„¤ì •ì—ì„œ ìˆ˜ì‹ ì„ ê±°ë¶€í•˜ì‹¤ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

â€» ë³¸ ë™ì˜ëŠ” ì„ íƒì‚¬í•­ì´ë©°, ë™ì˜í•˜ì§€ ì•Šì•„ë„ ì„œë¹„ìŠ¤ ì´ìš©ì—ëŠ” ì œí•œì´ ì—†ìŠµë‹ˆë‹¤.`,
        is_required: false,
        version: '1.0'
      }
    ];

    let termInserted = 0;
    let termSkipped = 0;

    for (const termData of terms) {
      const [term, created] = await Term.findOrCreate({
        where: { title: termData.title },
        defaults: termData
      });

      if (created) {
        termInserted++;
        console.log(`  âœ“ ${termData.title}`);
      } else {
        termSkipped++;
      }
    }

    console.log(`\nðŸ“Š ì•½ê´€ ë°ì´í„° ì²˜ë¦¬ ê²°ê³¼:`);
    console.log(`  - ìƒˆë¡œ ì¶”ê°€: ${termInserted}ê°œ`);
    console.log(`  - ì´ë¯¸ ì¡´ìž¬: ${termSkipped}ê°œ`);

    logger.info('í•„ìˆ˜ ë°ì´í„° ìƒì„± ì™„ë£Œ');
    console.log('\nâœ… í•„ìˆ˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
    console.log(`   ðŸ“š ê²¬ì¢…: ${insertedCount}ê°œ (ì‹ ê·œ)`);
    console.log(`   ðŸ“‹ ì•½ê´€: ${termInserted}ê°œ (ì‹ ê·œ)`);
    console.log('\nðŸ’¡ ìœ„ì¹˜ ë°ì´í„°ëŠ” ì‚¬ìš©ìž ê²€ìƒ‰ ì‹œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.');

  } catch (error) {
    logger.error('í•„ìˆ˜ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
    console.error('âŒ í•„ìˆ˜ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error.message);
    throw error;
  }
}

// ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ì‹¤í–‰ì‹œ
if (require.main === module) {
  seedData().then(() => {
    console.log('\nðŸŽ‰ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ! ì´ì œ API í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.');
    process.exit(0);
  }).catch((error) => {
    console.error(error);
    process.exit(1);
  });
}

module.exports = { seedData };
